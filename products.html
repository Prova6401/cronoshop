<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prodotti - Cronoshop</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    /* Badge styles with glass effect */
    .badge-animated {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      border-radius: 15px;
      padding: 0.3rem 0.8rem;
      font-size: 0.9em;
      font-weight: 600;
      color: var(--text-color);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      animation: badgeFloat 3s ease-in-out infinite;
      display: inline-block;
      margin-left: 8px;
      vertical-align: middle;
    }

    @keyframes badgeFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
    }

    .badge-samsung { border-color: rgba(0, 255, 255, 0.5); }
    .badge-apple { border-color: rgba(255, 0, 51, 0.5); }
    .badge-amazon { border-color: rgba(0, 210, 106, 0.5); }
    .badge-google { border-color: rgba(255, 214, 0, 0.5); }
    .badge-generic { border-color: rgba(136, 136, 136, 0.5); }

    /* Enhanced button styles */
    .amazon-link-btn {
      background: linear-gradient(135deg, rgba(255, 149, 0, 0.8) 0%, rgba(255, 204, 0, 0.8) 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      font-size: 1rem;
      margin: 0.3rem;
      cursor: pointer;
      transition: all var(--transition-duration);
      box-shadow: 0 4px 15px rgba(255, 149, 0, 0.3);
    }

    .amazon-link-btn:hover {
      background: linear-gradient(135deg, rgba(255, 149, 0, 1) 0%, rgba(255, 204, 0, 1) 100%);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 149, 0, 0.4);
    }

    .wishlist-btn {
      background: linear-gradient(135deg, rgba(255, 204, 0, 0.8) 0%, rgba(255, 149, 0, 0.8) 100%);
      color: #222;
      border: none;
      border-radius: 12px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      font-size: 1rem;
      margin: 0.3rem;
      cursor: pointer;
      transition: all var(--transition-duration);
      box-shadow: 0 4px 15px rgba(255, 204, 0, 0.3);
    }

    .wishlist-btn:hover {
      background: linear-gradient(135deg, rgba(255, 204, 0, 1) 0%, rgba(255, 149, 0, 1) 100%);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 204, 0, 0.4);
    }

    .wishlist-btn.in-wishlist {
      background: linear-gradient(135deg, rgba(255, 230, 102, 0.8) 0%, rgba(255, 179, 0, 0.8) 100%);
    }

    .like-btn {
      background: linear-gradient(135deg, rgba(255, 45, 85, 0.8) 0%, rgba(255, 99, 71, 0.8) 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      font-size: 1rem;
      margin: 0.3rem;
      cursor: pointer;
      transition: all var(--transition-duration);
      box-shadow: 0 4px 15px rgba(255, 45, 85, 0.3);
    }

    .like-btn:hover {
      background: linear-gradient(135deg, rgba(255, 45, 85, 1) 0%, rgba(255, 99, 71, 1) 100%);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 45, 85, 0.4);
    }

    .cart-btn {
      background: linear-gradient(135deg, rgba(48, 209, 88, 0.8) 0%, rgba(52, 199, 89, 0.8) 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 0.6rem 1.2rem;
      font-weight: 600;
      font-size: 1rem;
      margin: 0.3rem;
      cursor: pointer;
      transition: all var(--transition-duration);
      box-shadow: 0 4px 15px rgba(48, 209, 88, 0.3);
    }

    .cart-btn:hover {
      background: linear-gradient(135deg, rgba(48, 209, 88, 1) 0%, rgba(52, 199, 89, 1) 100%);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 25px rgba(48, 209, 88, 0.4);
    }

    .cart-btn.added {
      background: linear-gradient(135deg, rgba(76, 217, 100, 0.8) 0%, rgba(52, 199, 89, 0.8) 100%);
    }

    /* User score and ranking styles */
    .user-score {
      background: var(--glass-bg);
      backdrop-filter: var(--backdrop-blur);
      -webkit-backdrop-filter: var(--backdrop-blur);
      border: 1px solid var(--glass-border);
      border-radius: 15px;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 300px;
      text-align: center;
      box-shadow: var(--glass-shadow);
      position: relative;
    }

    .user-score::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: inherit;
      pointer-events: none;
    }

    .global-ranking {
      background: var(--glass-bg);
      backdrop-filter: var(--backdrop-blur);
      -webkit-backdrop-filter: var(--backdrop-blur);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 2rem;
      margin: 2rem auto;
      max-width: 600px;
      box-shadow: var(--glass-shadow);
      position: relative;
    }

    .global-ranking::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: inherit;
      pointer-events: none;
    }

    .global-ranking h2 {
      color: var(--text-color);
      margin-bottom: 1rem;
      text-align: center;
      position: relative;
      z-index: 1;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .global-ranking ol {
      list-style: none;
      padding: 0;
      position: relative;
      z-index: 1;
    }

    .global-ranking li {
      padding: 0.5rem;
      margin: 0.3rem 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--text-color);
    }
  </style>
</head>
<body>
  <div id="user-profile-widget" style="display:none;">
    <img id="profile-pic-widget" src="https://ui-avatars.com/api/?name=User&background=eeeeee&color=0071e3" alt="Foto profilo">
    <div id="user-info-text">
      <div class="username-display" id="widget-username"></div>
      <div class="email-display" id="widget-email"></div>
      <button class="logout-button" onclick="logoutUser(event)">Logout</button>
    </div>
  </div>

  <div id="account-banner">
    <span>Hai un account Cronoshop? <b>Accedi</b> o <b>registrati</b> per offerte personalizzate!</span>
    <button id="open-login">Accedi</button>
    <button id="open-register">Registrati</button>
  </div>

  <div class="modal-bg" id="modal-bg">
    <div class="modal" id="modal-login" style="display:none;">
      <button class="close-modal" onclick="closeModal()">&times;</button>
      <h2>Accedi</h2>
      <input type="text" id="login-username" placeholder="Username" autocomplete="username">
      <input type="password" id="login-password" placeholder="Password" autocomplete="current-password">
      <div class="error-msg" id="login-error"></div>
      <button onclick="loginUser()">Accedi</button>
      <div class="switch-link" onclick="showRegister()">Non hai un account? Registrati</div>
    </div>
    <div class="modal" id="modal-register" style="display:none;">
      <button class="close-modal" onclick="closeModal()">&times;</button>
      <h2>Registrati</h2>
      <input type="text" id="register-username" placeholder="Scegli username" autocomplete="username">
      <input type="password" id="register-password" placeholder="Scegli password" autocomplete="new-password">
      <div class="error-msg" id="register-error"></div>
      <button onclick="registerUser()">Registrati</button>
      <div class="switch-link" onclick="showLogin()">Hai già un account? Accedi</div>
    </div>
  </div>

  <header>
    <h1>I nostri prodotti</h1>
  </header>
  
  <nav>
    <a href="index.html">Home</a>
    <a href="products.html">Prodotti <span id="cart-count" style="background:#30d158;color:#fff;border-radius:50%;padding:2px 8px;font-size:0.9em;vertical-align:top;margin-left:2px;">0</span></a>
    <a href="groups.html">Gruppi</a>
    <a href="come-funziona.html">Come Funziona</a>
    <a href="faq.html">FAQ</a>
    <a href="favorites.html">Preferiti</a>
    <a href="account.html">Area Personale</a>
    <a href="cart.html">Carrello</a>
  </nav>

  <main>
    <div class="user-score" id="user-score"></div>
    <section class="global-ranking" id="global-ranking">
      <h2>Classifica utenti più attivi</h2>
      <ol id="ranking-list"></ol>
    </section>
    
    <div style="text-align: center; margin: 2rem 0;">
        <input type="text" id="search-input" placeholder="Cerca un prodotto..." style="padding: 1rem 1.5rem; border-radius: 20px; border: 1px solid var(--glass-border); font-size: 1.1rem; width: 80%; max-width: 500px; background: var(--glass-bg); backdrop-filter: var(--backdrop-blur); -webkit-backdrop-filter: var(--backdrop-blur); color: var(--text-color); box-shadow: var(--glass-shadow);">
    </div>

    <section class="product-grid" id="product-grid">
    </section>
  </main>

  <script>
    // --- Funzioni di Account e Tema Universali ---

    function hash(str) {
      let h = 0, i, chr;
      if (str.length === 0) return h;
      for (i = 0; i < str.length; i++) {
        chr = str.charCodeAt(i);
        h = ((h << 5) - h) + chr;
        h |= 0;
      }
      return h;
    }

    function getUser() {
      return JSON.parse(localStorage.getItem('cronoshop_user') || 'null');
    }
    function setUser(user) {
      localStorage.setItem('cronoshop_user', JSON.stringify(user));
    }
    function removeUser() {
      localStorage.removeItem('cronoshop_user');
    }
    function getUserDb(username) {
        return JSON.parse(localStorage.getItem('cronoshop_user_db_' + username) || 'null');
    }
    function setUserDb(username, data) {
      localStorage.setItem('cronoshop_user_db_' + username, JSON.stringify(data));
    }

    function applyTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    }

    function loadThemePreference() {
        const user = getUser();
        let savedTheme = 'light';
        if (user && user.username) {
            const userDb = getUserDb(user.username);
            if (userDb && userDb.settings && userDb.settings.theme) {
                savedTheme = userDb.settings.theme;
            }
        } else {
            savedTheme = localStorage.getItem('global_theme_preference') || 'light';
        }
        applyTheme(savedTheme);
    }

    function updateAccountBannerAndWidget() {
      const user = getUser();
      const banner = document.getElementById('account-banner');
      const profileWidget = document.getElementById('user-profile-widget');
      const profilePicWidget = document.getElementById('profile-pic-widget');
      const widgetUsername = document.getElementById('widget-username');
      const widgetEmail = document.getElementById('widget-email');

      if (user && user.username) {
        if (banner) banner.style.display = 'none';
        if (profileWidget) profileWidget.style.display = 'flex';
        const userDb = getUserDb(user.username);
        if (profilePicWidget) {
            if (userDb && userDb.profilePic) {
                profilePicWidget.src = userDb.profilePic;
            } else {
                profilePicWidget.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&background=eeeeee&color=0071e3`;
            }
        }
        if (widgetUsername) widgetUsername.textContent = user.username;
        if (widgetEmail) widgetEmail.textContent = userDb && userDb.email ? userDb.email : 'Nessuna email';
      } else {
        if (banner) banner.style.display = 'flex';
        if (profileWidget) profileWidget.style.display = 'none';
      }
    }

    function openModal(type) {
      const modalBg = document.getElementById('modal-bg');
      const modalLogin = document.getElementById('modal-login');
      const modalRegister = document.getElementById('modal-register');
      const loginError = document.getElementById('login-error');
      const registerError = document.getElementById('register-error');

      if (modalBg) modalBg.classList.add('active');
      if (modalLogin) modalLogin.style.display = type === 'login' ? 'block' : 'none';
      if (modalRegister) modalRegister.style.display = type === 'register' ? 'block' : 'none';
      if (loginError) loginError.textContent = '';
      if (registerError) registerError.textContent = '';
    }
    function closeModal() {
      const modalBg = document.getElementById('modal-bg');
      if (modalBg) modalBg.classList.remove('active');
    }
    function showLogin() { openModal('login'); }
    function showRegister() { openModal('register'); }

    function registerUser() {
      const usernameInput = document.getElementById('register-username');
      const passwordInput = document.getElementById('register-password');
      const errorElement = document.getElementById('register-error');

      const username = usernameInput ? usernameInput.value.trim() : '';
      const password = passwordInput ? passwordInput.value : '';
      const error = errorElement;

      if (!username || !password) {
        if (error) error.textContent = 'Compila tutti i campi.';
        return;
      }
      if (localStorage.getItem('cronoshop_user_db_' + username)) {
        if (error) error.textContent = 'Username già registrato.';
        return;
      }
      localStorage.setItem('cronoshop_user_db_' + username, JSON.stringify({
        username,
        password: hash(password),
        email: '',
        settings: { theme: 'light', notifications: { email: false } }
      }));
      setUser({ username });
      closeModal();
      updateAccountBannerAndWidget();
      loadThemePreference();
    }

    function loginUser() {
      const usernameInput = document.getElementById('login-username');
      const passwordInput = document.getElementById('login-password');
      const errorElement = document.getElementById('login-error');

      const username = usernameInput ? usernameInput.value.trim() : '';
      const password = passwordInput ? passwordInput.value : '';
      const error = errorElement;

      const userDb = JSON.parse(localStorage.getItem('cronoshop_user_db_' + username) || 'null');
      if (!userDb || userDb.password !== hash(password)) {
        if (error) error.textContent = 'Username o password errati.';
        return;
      }
      setUser({ username });
      closeModal();
      updateAccountBannerAndWidget();
      loadThemePreference();
    }

    function logoutUser(event) {
      if (event) event.stopPropagation();
      removeUser();
      updateAccountBannerAndWidget();
      applyTheme('light');
      localStorage.removeItem('global_theme_preference');
    }

    // --- FINE Funzioni di Account e Tema Universali ---

    // --- DATI PRODOTTI ---
    const prodotti = [
  {
    id: "prod1",
    link: "https://amzn.to/3Z551fa",
    img: "https://m.media-amazon.com/images/I/61hiFJPpY9L._AC_SL1500_.jpg",
    nome: "Samsung Galaxy S25 Ultra",
    prezzo: "1.199€",
    descrizione: "Smartphone AI con display 6.9\" QHD+ Dynamic AMOLED 2X, fotocamera da 200MP, RAM 12GB, memoria interna da 256GB, batteria da 5000 mAh. Colore Titanium Silverblue. Garanzia 3 anni."
  },
  {
    id: "prod2",
    link: "https://amzn.to/4mB7UhK",
    img: "https://m.media-amazon.com/images/I/71b8mpCMTOL._AC_SL1500_.jpg",
    nome: "by Amazon Quinoa biologica, 500g",
    prezzo: "5,49€",
    descrizione: "Quinoa biologica di alta qualità, ricca di proteine e fibre. Perfetta per insalate e piatti salutari."
  },
  {
    id: "prod3",
    link: "https://www.amazon.it/dp/B0CHWV5HTM",
    img: "https://m.media-amazon.com/images/I/71d7rfSl0wL._AC_SL1500_.jpg",
    nome: "Apple iPhone 15",
    prezzo: `<span style="text-decoration: line-through; color: #888;">879,00€</span> <span style="color: #007aff; font-weight: bold;">645,00€</span> <span style="color: red; font-weight: bold;">-27%</span>`,
    descrizione: "Prestazioni top per l'uso quotidiano."
  }
];

    // --- UTENTE ---
    function getLikes() {
      return JSON.parse(localStorage.getItem('cronoshop_likes') || '{}');
    }
    function setLikes(likes) {
      localStorage.setItem('cronoshop_likes', JSON.stringify(likes));
    }
    function getCart() {
      return JSON.parse(localStorage.getItem('cronoshop_cart') || '[]');
    }
    function setCart(cart) {
      localStorage.setItem('cronoshop_cart', JSON.stringify(cart));
    }
    function count() {
      const cart = getCart();
      const cartCountElement = document.getElementById('cart-count');
      if (cartCountElement) {
        cartCountElement.textContent = cart.length;
      }
    }

    function getPoints() {
      return JSON.parse(localStorage.getItem('cronoshop_points') || '{}');
    }
    function setPoints(points) {
      localStorage.setItem('cronoshop_points', JSON.stringify(points));
    }
    function getFavorites() {
  return JSON.parse(localStorage.getItem('cronoshop_favorites') || '[]');
}
function setFavorites(favs) {
  localStorage.setItem('cronoshop_favorites', JSON.stringify(favs));
}
function getWishlist() {
  return JSON.parse(localStorage.getItem('cronoshop_wishlist') || '[]');
}
function setWishlist(wishlist) {
  localStorage.setItem('cronoshop_wishlist', JSON.stringify(wishlist));
}

// Utility per categoria (puoi lasciarla se ti serve per i badge)
function getCategory(prod) {
  const name = prod.nome.toLowerCase();
  if (name.includes('samsung')) return 'samsung';
  if (name.includes('apple') || name.includes('iphone') || name.includes('airpods')) return 'apple';
  if (name.includes('amazon')) return 'amazon';
  if (name.includes('google') || name.includes('pixel')) return 'google';
  return 'altro';
}

// --- RENDER PRODOTTI ---
function getProductBadge(prod) {
  const cat = getCategory(prod);
  if (cat === 'samsung') return `<span class="badge-animated badge-samsung">Samsung</span>`;
  if (cat === 'apple') return `<span class="badge-animated badge-apple">Apple</span>`;
  if (cat === 'amazon') return `<span class="badge-animated badge-amazon">Amazon</span>`;
  if (cat === 'google') return `<span class="badge-animated badge-google">Google</span>`;
  return `<span class="badge-animated badge-generic">Altro</span>`;
}

function renderProducts(filtro = '') {
  const likes = getLikes();
  const cart = getCart();
  const wishlist = getWishlist();
  const grid = document.getElementById('product-grid');
  grid.innerHTML = '';
  const filtroLower = filtro.toLowerCase();

  prodotti
    .filter(prod => prod.nome.toLowerCase().includes(filtroLower) || prod.descrizione.toLowerCase().includes(filtroLower))
    .forEach(prod => {
      const liked = likes[prod.id] === true;
      const inCart = cart.includes(prod.id);
      const inWishlist = wishlist.includes(prod.id);
      const priceHtml = prod.prezzo.toString().includes('<span') ? prod.prezzo : `<span class="price">${prod.prezzo}</span>`;
      const badge = getProductBadge(prod);
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <img src="${prod.img}" alt="${prod.nome}" class="product-img">
        <h3>${prod.nome} ${badge}</h3>
        <p class="price">${priceHtml}</p>
        <p>${prod.descrizione}</p>
        <button class="like-btn${liked ? ' liked' : ''}" data-id="${prod.id}">${liked ? '❤️' : '🤍'} Mi piace</button>
        <button class="wishlist-btn${inWishlist ? ' in-wishlist' : ''}" data-id="${prod.id}">${inWishlist ? 'Nella lista dei desideri' : 'Aggiungi alla lista dei desideri'}</button>
        <button class="cart-btn${inCart ? ' added' : ''}" data-id="${prod.id}">${inCart ? 'Aggiunto!' : 'Aggiungi al carrello'}</button>
        <a href="${prod.link}" class="amazon-link" data-id="${prod.id}" target="_blank" rel="noopener noreferrer">
          <button class="amazon-link-btn">Compra su Amazon</button>
        </a>
      `;
      grid.appendChild(card);
    });
}

// --- EVENTI ---
document.addEventListener('click', function(e) {
      // Mi piace
      if (e.target.classList.contains('like-btn')) {
        const id = e.target.getAttribute('data-id');
        const likes = getLikes();
        likes[id] = !likes[id];
        setLikes(likes);

        // AGGIUNGI/RIMUOVI DAI PREFERITI
        let favs = JSON.parse(localStorage.getItem('cronoshop_favorites') || '[]');
        if (likes[id]) {
          if (!favs.includes(id)) favs.push(id);
        } else {
          favs = favs.filter(pid => pid !== id);
        }
        localStorage.setItem('cronoshop_favorites', JSON.stringify(favs));

        renderProducts(document.getElementById('search-input').value);
        count();
        // Aggiorna anche la pagina dei preferiti se aperta
        if (window.location.pathname.endsWith('favorites.html') && typeof renderFavorites === 'function') renderFavorites();
      }
      // Carrello
      if (e.target.classList.contains('cart-btn')) {
        const id = e.target.getAttribute('data-id');
        let cart = getCart();
        if (!cart.includes(id)) {
          cart.push(id);
        } else {
          cart = cart.filter(pid => pid !== id);
        }
        setCart(cart);
        renderProducts(document.getElementById('search-input').value);
        count();
      }
      // Lista dei desideri
      if (e.target.classList.contains('wishlist-btn')) {
        const id = e.target.getAttribute('data-id');
        let wishlist = getWishlist();
        if (!wishlist.includes(id)) {
          wishlist.push(id);
        } else {
          wishlist = wishlist.filter(pid => pid !== id);
        }
        setWishlist(wishlist);
        renderProducts(document.getElementById('search-input').value);
        // Aggiorna anche la pagina dei preferiti se aperta
        if (window.location.pathname.endsWith('favorites.html') && typeof renderFavorites === 'function') renderFavorites();
      }
      // Tracciamento click Amazon SOLO SE LOGGATO
      if (e.target.closest('.amazon-link')) {
        const user = getUser();
        if (user && user.username) {
          addPoint(user.username);
          updateRanking();
          updateUserScore();
        }
      }
    });

    // --- PUNTI E CLASSIFICA ---
    function addPoint(username) {
      if (!username) return;
      const points = getPoints();
      if (!points[username]) points[username] = 0;
      points[username]++;
      setPoints(points);
    }

    function updateUserScore() {
      const user = getUser();
      const scoreElement = document.getElementById('user-score');
      if (user && user.username && scoreElement) {
        const points = getPoints();
        const userPoints = points[user.username] || 0;
        scoreElement.innerHTML = `<strong>${user.username}</strong><br>Punti: ${userPoints}`;
        scoreElement.style.display = 'block';
      } else if (scoreElement) {
        scoreElement.style.display = 'none';
      }
    }

    function updateRanking() {
      // Logica per aggiornare la classifica
      const points = getPoints();
      const validUsers = Object.keys(points).filter(username => localStorage.getItem('cronoshop_user_db_' + username));
      const ranking = validUsers.map(username => [username, points[username]]).sort((a, b) => b[1] - a[1]);
      const list = document.getElementById('ranking-list');
      if (list) {
        list.innerHTML = '';
        ranking.slice(0, 10).forEach(([user, score], i) => {
          list.innerHTML += `<li>${i === 0 ? '🏆 ' : ''}${user} <span style="color:#30D158;font-weight:600;">${score}</span></li>`;
        });
      }
    }

    // --- INIZIALIZZA ---
    document.addEventListener('DOMContentLoaded', function() {
  loadThemePreference();
  updateAccountBannerAndWidget();

  const openLoginBtn = document.getElementById('open-login');
  const openRegisterBtn = document.getElementById('open-register');
  const modalBg = document.getElementById('modal-bg');
  const userProfileWidget = document.getElementById('user-profile-widget');

  if (openLoginBtn) openLoginBtn.onclick = showLogin;
  if (openRegisterBtn) openRegisterBtn.onclick = showRegister;
  if (modalBg) {
    modalBg.onclick = function(e) {
      if (e.target === this) closeModal();
    };
  }
  if (userProfileWidget) {
    userProfileWidget.addEventListener('click', function(e) {
      if (e.target.classList.contains('logout-button')) {
        return;
      }
      window.location.href = "account.html";
    });
  }

  renderProducts();
  document.getElementById('search-input').addEventListener('input', function(e) {
    renderProducts(e.target.value);
   });
  count();
  updateUserScore();
  updateRanking();
});
</script>
</body>
</html>