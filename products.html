<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prodotti - Cronoshop</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    /* ... (stili esistenti e universali come nel tuo products.html attuale) ... */

    /* Stili specifici per il convertitore di link */
    .link-converter-section {
        max-width: 700px;
        margin: 2rem auto;
        background: var(--card-background);
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        padding: 1.5rem 1rem;
        text-align: center;
        border: 1px solid var(--border-color);
    }
    .link-converter-section h2 {
        color: var(--primary-color);
        font-size: 1.3rem;
        margin-bottom: 1rem;
    }
    .link-converter-section p {
        font-size: 1rem;
        color: #6e6e73;
        margin-bottom: 1.5rem;
    }
    .link-converter-section input[type="text"] {
        width: calc(100% - 2rem);
        padding: 0.8rem 1rem;
        border-radius: 12px;
        border: 1px solid #ccc;
        font-size: 1rem;
        margin-bottom: 1rem;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        color: var(--text-color); /* Adatta al tema */
        background-color: var(--card-background); /* Adatta al tema */
    }
    .link-converter-section button {
        background-color: var(--primary-color);
        color: #fff;
        border: none;
        border-radius: 12px;
        padding: 0.8rem 1.8rem;
        font-weight: 600;
        cursor: pointer;
        font-size: 1.05rem;
        transition: background-color 0.25s cubic-bezier(.4,0,.2,1);
        box-shadow: 0 2px 8px rgba(0,113,227,0.10);
        margin-bottom: 1rem;
    }
    .link-converter-section button:hover {
        background-color: #0051a8;
    }
    .generated-link-box {
        background-color: #eaf6ff;
        border: 1px solid #cce8ff;
        padding: 1rem;
        border-radius: 12px;
        margin-top: 1.5rem;
        display: none; /* Inizialmente nascosto */
        flex-direction: column;
        align-items: center;
        gap: 0.8rem;
    }
    .generated-link-box.active {
        display: flex;
    }
    .generated-link-box input {
        width: 100%;
        padding: 0.6rem;
        border: 1px dashed #0071e3;
        border-radius: 8px;
        font-size: 0.95rem;
        text-align: center;
        color: #0071e3;
        background-color: #f7fbff;
        cursor: text;
        user-select: all; /* Permette selezione facile */
    }
    .generated-link-box button {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
        margin-bottom: 0;
    }

    /* Regole Dark Mode per il convertitore di link */
    body.dark-mode .link-converter-section {
        background: var(--dark-card-background);
        box-shadow: 0 4px 16px var(--dark-card-shadow);
        border-color: var(--dark-border-color);
    }
    body.dark-mode .link-converter-section h2 {
        color: var(--dark-primary-color);
    }
    body.dark-mode .link-converter-section p {
        color: var(--dark-text-color);
    }
    body.dark-mode .link-converter-section input[type="text"] {
        background-color: var(--dark-border-color);
        border-color: #555;
        color: var(--dark-text-color);
    }
    body.dark-mode .generated-link-box {
        background-color: #3a3a3c;
        border-color: #555;
    }
    body.dark-mode .generated-link-box input {
        background-color: #4a4a4e;
        border-color: var(--dark-primary-color);
        color: var(--dark-primary-color);
    }


  </style>
</head>
<body>
  <div id="user-profile-widget">
    <img id="profile-pic-widget" src="https://ui-avatars.com/api/?name=User&background=eeeeee&color=0071e3" alt="Foto profilo">
    <div id="user-info-text">
      <div class="username-display" id="widget-username"></div>
      <div class="email-display" id="widget-email"></div>
      <button class="logout-button" onclick="logoutUser(event)">Logout</button>
    </div>
  </div>

  <div id="account-banner">
    <span>Hai un account Cronoshop? <b>Accedi</b> o <b>registrati</b> per offerte personalizzate!</span>
    <button id="open-login">Accedi</button>
    <button id="open-register">Registrati</button>
  </div>

  <div class="modal-bg" id="modal-bg">
    <div class="modal" id="modal-login">
      <button class="close-modal" onclick="closeModal()">&times;</button>
      <h2>Accedi</h2>
      <input type="text" id="login-username" placeholder="Username" autocomplete="username">
      <input type="password" id="login-password" placeholder="Password" autocomplete="current-password">
      <div class="error-msg" id="login-error"></div>
      <button onclick="loginUser()">Accedi</button>
      <div class="switch-link" onclick="showRegister()">Non hai un account? Registrati</div>
    </div>
    <div class="modal" id="modal-register">
      <button class="close-modal" onclick="closeModal()">&times;</button>
      <h2>Registrati</h2>
      <input type="text" id="register-username" placeholder="Scegli username" autocomplete="username">
      <input type="password" id="register-password" placeholder="Scegli password" autocomplete="new-password">
      <div class="error-msg" id="register-error"></div>
      <button onclick="registerUser()">Registrati</button>
      <div class="switch-link" onclick="showLogin()">Hai già un account? Accedi</div>
    </div>
  </div>

  <header>
    <h1>I nostri prodotti</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="products.html">Prodotti <span id="cart-count" style="background:#30d158;color:#fff;border-radius:50%;padding:2px 8px;font-size:0.9em;vertical-align:top;margin-left:2px;">0</span></a>
      <a href="gropus.html">Gruppi</a>
      <a href="come-funziona.html">Come Funziona</a>
      <a href="faq.html">FAQ</a>
      <a href="favorites.html">Preferiti</a>
      <a href="account.html">Area Personale</a>
      <a href="cart.html">Carrello</a>
    </nav>
  </header>

  <main>
    <div class="user-score" id="user-score"></div>
    <section class="global-ranking" id="global-ranking">
      <h2>Classifica utenti più attivi</h2>
      <ol id="ranking-list"></ol>
    </section>
    
    <div style="text-align: center; margin: 2rem 0;">
        <input type="text" id="search-input" placeholder="Cerca un prodotto..." style="padding: 0.6rem 1.2rem; border-radius: 12px; border: 1px solid #ccc; font-size: 1rem; width: 80%; max-width: 400px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
    </div>

    <section class="link-converter-section">
        <h2>Trasforma un link Amazon nel tuo link affiliato!</h2>
        <p>Incolla qui il link di un prodotto Amazon per generare il tuo link affiliato e condividere le offerte con i tuoi amici.</p>
        <input type="text" id="amazon-url-input" placeholder="Incolla qui il link del prodotto Amazon...">
        <button onclick="generateAffiliateLink()">Genera Link Affiliato</button>
        <div id="generated-link-output" class="generated-link-box">
            <span>Ecco il tuo link personalizzato:</span>
            <input type="text" id="affiliate-output-url" readonly>
            <button onclick="copyAffiliateLink()">Copia Link</button>
            <a id="go-to-amazon-link" href="#" target="_blank" rel="noopener noreferrer">
              <button>Vai su Amazon</button>
            </a>
        </div>
        <div class="error-msg" id="link-converter-error" style="margin-top: 1rem;"></div>
    </section>
    <section class="product-grid" id="product-grid">
      </section>
  </main>

  <script>
    // --- Funzioni di Account e Tema Universali (copia da index.html) ---

    // Helpers
    function hash(str) {
      let h = 0, i, chr;
      if (str.length === 0) return h;
      for (i = 0; i < str.length; i++) {
        chr = str.charCodeAt(i);
        h = ((h << 5) - h) + chr;
        h |= 0;
      }
      return h;
    }

    function getUser() {
      return JSON.parse(localStorage.getItem('cronoshop_user') || 'null');
    }
    function setUser(user) {
      localStorage.setItem('cronoshop_user', JSON.stringify(user));
    }
    function removeUser() {
      localStorage.removeItem('cronoshop_user');
    }
    function getUserDb(username) {
        return JSON.parse(localStorage.getItem('cronoshop_user_db_' + username) || 'null');
    }
    function setUserDb(username, data) {
      localStorage.setItem('cronoshop_user_db_' + username, JSON.stringify(data));
    }


    // Gestione del Tema
    function applyTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
    }

    function loadThemePreference() {
        const user = getUser();
        let savedTheme = 'light'; // Default theme
        if (user && user.username) {
            const userDb = getUserDb(user.username);
            if (userDb && userDb.settings && userDb.settings.theme) {
                savedTheme = userDb.settings.theme;
            }
        } else {
            // Se non loggato, controlla una preferenza globale non utente specifica (opzionale)
            savedTheme = localStorage.getItem('global_theme_preference') || 'light';
        }
        applyTheme(savedTheme);
    }

    // Banner e widget account
    function updateAccountBannerAndWidget() {
      const user = getUser();
      const banner = document.getElementById('account-banner');
      const profileWidget = document.getElementById('user-profile-widget');
      const profilePicWidget = document.getElementById('profile-pic-widget');
      const widgetUsername = document.getElementById('widget-username');
      const widgetEmail = document.getElementById('widget-email');

      if (user && user.username) {
        if (banner) banner.style.display = 'none';
        if (profileWidget) profileWidget.style.display = 'flex'; // Mostra il widget
        const userDb = getUserDb(user.username);
        if (profilePicWidget) {
            if (userDb && userDb.profilePic) {
                profilePicWidget.src = userDb.profilePic;
            } else {
                profilePicWidget.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&background=eeeeee&color=0071e3`;
            }
        }
        if (widgetUsername) widgetUsername.textContent = user.username;
        if (widgetEmail) widgetEmail.textContent = userDb && userDb.email ? userDb.email : 'Nessuna email';

      } else {
        if (banner) banner.style.display = 'flex';
        if (profileWidget) profileWidget.style.display = 'none'; // Nasconde il widget
      }
    }

    // Modale Login/Registrazione
    function openModal(type) {
      const modalBg = document.getElementById('modal-bg');
      const modalLogin = document.getElementById('modal-login');
      const modalRegister = document.getElementById('modal-register');
      const loginError = document.getElementById('login-error');
      const registerError = document.getElementById('register-error');

      if (modalBg) modalBg.classList.add('active');
      if (modalLogin) modalLogin.style.display = type === 'login' ? 'block' : 'none';
      if (modalRegister) modalRegister.style.display = type === 'register' ? 'block' : 'none';
      if (loginError) loginError.textContent = '';
      if (registerError) registerError.textContent = '';
    }
    function closeModal() {
      const modalBg = document.getElementById('modal-bg');
      if (modalBg) modalBg.classList.remove('active');
    }
    function showLogin() { openModal('login'); }
    function showRegister() { openModal('register'); }

    // Registrazione
    function registerUser() {
      const usernameInput = document.getElementById('register-username');
      const passwordInput = document.getElementById('register-password');
      const errorElement = document.getElementById('register-error');

      const username = usernameInput ? usernameInput.value.trim() : '';
      const password = passwordInput ? passwordInput.value : '';
      const error = errorElement;

      if (!username || !password) {
        if (error) error.textContent = 'Compila tutti i campi.';
        return;
      }
      if (localStorage.getItem('cronoshop_user_db_' + username)) {
        if (error) error.textContent = 'Username già registrato.';
        return;
      }
      localStorage.setItem('cronoshop_user_db_' + username, JSON.stringify({
        username,
        password: hash(password),
        email: '', // Inizializza l'email vuota
        settings: { theme: 'light', notifications: { email: false } } // Impostazioni predefinite
      }));
      setUser({ username });
      closeModal();
      updateAccountBannerAndWidget();
      loadThemePreference(); // Applica il tema predefinito al login
    }

    // Login
    function loginUser() {
      const usernameInput = document.getElementById('login-username');
      const passwordInput = document.getElementById('login-password');
      const errorElement = document.getElementById('login-error');

      const username = usernameInput ? usernameInput.value.trim() : '';
      const password = passwordInput ? passwordInput.value : '';
      const error = errorElement;

      const userDb = JSON.parse(localStorage.getItem('cronoshop_user_db_' + username) || 'null');
      if (!userDb || userDb.password !== hash(password)) {
        if (error) error.textContent = 'Username o password errati.';
        return;
      }
      setUser({ username });
      closeModal();
      updateAccountBannerAndWidget();
      loadThemePreference(); // Applica il tema salvato al login
    }

    // Logout
    function logoutUser(event) {
      if (event) event.stopPropagation(); // Evita che il click si propaghi al widget
      removeUser();
      updateAccountBannerAndWidget();
      applyTheme('light'); // Torna al tema chiaro al logout
      localStorage.removeItem('global_theme_preference'); // Rimuovi preferenza globale se non loggato
      // Reindirizza l'utente alla home o alla pagina corrente se preferisci
      // window.location.href = "index.html";
    }

    // --- Fine Funzioni di Account e Tema Universali ---

    // --- LOGICA DEL CONVERTITORE DI LINK AFFILIATO ---
    const YOUR_AFFILIATE_TAG = "cronoshop-21"; // <--- INSERISCI QUI IL TUO ID AFFILIATO!

    function generateAffiliateLink() {
        const inputUrl = document.getElementById('amazon-url-input').value.trim();
        const outputBox = document.getElementById('generated-link-output');
        const outputUrlInput = document.getElementById('affiliate-output-url');
        const errorDisplay = document.getElementById('link-converter-error');
        const goToAmazonLink = document.getElementById('go-to-amazon-link');

        errorDisplay.textContent = ''; // Pulisce eventuali errori precedenti
        outputBox.classList.remove('active'); // Nasconde il box di output

        if (!inputUrl) {
            errorDisplay.textContent = "Per favore, incolla un URL di Amazon.";
            return;
        }

        let parsedUrl;
        try {
            parsedUrl = new URL(inputUrl);
        } catch (e) {
            errorDisplay.textContent = "URL non valido. Assicurati che sia un link completo.";
            return;
        }

        // Verifica se l'URL è di Amazon
        if (!parsedUrl.hostname.includes("amazon.")) {
            errorDisplay.textContent = "Questo non sembra un link di Amazon. Incolla un URL da amazon.it o simili.";
            return;
        }

        // Rimuovi eventuali tag affiliato esistenti
        parsedUrl.searchParams.delete('tag');
        
        // Aggiungi il tuo tag affiliato
        parsedUrl.searchParams.set('tag', YOUR_AFFILIATE_TAG);

        const newAffiliateUrl = parsedUrl.toString();
        outputUrlInput.value = newAffiliateUrl;
        goToAmazonLink.href = newAffiliateUrl; // Imposta il link per il pulsante "Vai su Amazon"
        outputBox.classList.add('active'); // Mostra il box di output

        // Aggiungi un punto per ogni generazione di link (se l'utente è loggato)
        const user = getUser();
        if (user && user.username) {
            addPoint(user.username); // Assicurati che addPoint() sia definito e funzioni
            updateUserScore(); // Assicurati che updateUserScore() sia definito
        }
    }

    function copyAffiliateLink() {
        const outputUrlInput = document.getElementById('affiliate-output-url');
        if (outputUrlInput) {
            outputUrlInput.select();
            outputUrlInput.setSelectionRange(0, 99999); // Per mobile
            document.execCommand("copy");
            alert("Link copiato!");
        }
    }
    // --- FINE LOGICA DEL CONVERTITORE DI LINK AFFILIATO ---


    // --- DATI PRODOTTI ---
    const prodotti = [
  {
    id: "prod1",
    link: "https://amzn.to/3Z551fa",
    img: "https://m.media-amazon.com/images/I/61hiFJPpY9L._AC_SL1500_.jpg",
    nome: "Samsung Galaxy S25 Ultra",
    prezzo: "1.199€",
    descrizione: "Smartphone AI con display 6.9\" QHD+ Dynamic AMOLED 2X, fotocamera da 200MP, RAM 12GB, memoria interna da 256GB, batteria da 5000 mAh. Colore Titanium Silverblue. Garanzia 3 anni."
  },
  {
    id: "prod2",
    link: "https://amzn.to/4mB7UhK",
    img: "https://m.media-amazon.com/images/I/71b8mpCMTOL._AC_SL1500_.jpg",
    nome: "by Amazon Quinoa biologica, 500g",
    prezzo: "5,49€",
    descrizione: "Quinoa biologica di alta qualità, ricca di proteine e fibre. Perfetta per insalate e piatti salutari."
  },
  {
    id: "prod3",
    link: "https://www.amazon.it/dp/B0CHWV5HTM",
    img: "https://m.media-amazon.com/images/I/71d7rfSl0wL._AC_SL1500_.jpg",
    nome: "Apple iPhone 15",
    prezzo: `<span style="text-decoration: line-through; color: #888;">879,00€</span> <span style="color: #007aff; font-weight: bold;">645,00€</span> <span style="color: red; font-weight: bold;">-27%</span>`,
    descrizione: "Prestazioni top per l'uso quotidiano."
  },
  {
    id: "prod4",
    link: "https://amzn.to/4kCH9aV",
    img: "https://m.media-amazon.com/images/I/618ha2Ia5tL._AC_SL1500_.jpg",
    nome: "Samsung Galaxy S25 Smartphone AI",
    prezzo: "929,00€",
    descrizione: "Smartphone con display 6.2'' FHD+ Dynamic AMOLED 2X, fotocamera da 50MP, RAM 12GB, memoria interna 256GB, batteria da 4.000 mAh. Include 3 anni di garanzia del produttore. Colore: Mint."
  },
  {
    id: "prod5",
    link: "https://amzn.to/3ZAt8T4",
    img: "https://m.media-amazon.com/images/I/61Wj-1t3TwL._AC_SL1500_.jpg",
    nome: "SAMSUNG Galaxy S25 Edge",
    prezzo: "1.299,00€",
    descrizione: "Smartphone AI con display 6.7'' QHD+ Dynamic AMOLED 2X, fotocamera da 200MP, RAM 12GB, memoria interna da 512GB, batteria da 3.900 mAh. Include 3 anni di garanzia del produttore. Colore: Titanium Jetblack."
  },
  {
    id: "prod6",
    link: "https://amzn.to/45gPEUX",
    img: "https://m.media-amazon.com/images/I/61y0hmQWlsL._AC_SL1500_.jpg",
    nome: "Samsung Galaxy S25+ Smartphone AI",
    prezzo: "1.189,00€",
    descrizione: "Smartphone AI con display 6.7'' QHD+ Dynamic AMOLED 2X, fotocamera da 50MP, RAM 12GB, memoria interna da 512GB, batteria da 4.900 mAh. Include 3 anni di garanzia del produttore. Colore: Silver Shadow. Versione italiana."
  },
  {
    id: "prod7",
    link: "https://amzn.to/3Z6Kc2W",
    img: "https://m.media-amazon.com/images/I/610vqacJO2L.__AC_SY445_SX342_QL70_ML2_.jpg",
    nome: "Apple iPhone 16e – 128 GB",
    prezzo: "699,00€",
    descrizione: "Progettato per Apple Intelligence, dotato di chip A18, autonomia grandiosa, fotocamera Fusion da 48MP e display Super Retina XDR da 6,1\". Colore: Bianco."
  },
  {
    id: "prod8",
    link: "https://amzn.to/3ZEqKut",
    img: "https://m.media-amazon.com/images/I/61cUeqowwZL._AC_SL1500_.jpg",
    nome: "Apple iPhone 16 Pro Max – 256 GB",
    prezzo: "1.195,00€",
    descrizione: "Telefono 5G con controllo fotocamera avanzato, registrazione video Dolby Vision 4K a 120 fps e autonomia senza precedenti. Compatibile con AirPods. Colore: Titanio Nero."
  },
  {
    id: "prod9",
    link: "https://amzn.to/43t1D0l",
    img: "https://m.media-amazon.com/images/I/61BGE6iu4AL.__AC_SY445_SX342_QL70_ML2_.jpg",
    nome: "Apple iPhone 14 Plus – 128 GB",
    prezzo: "871,00€",
    descrizione: "Smartphone Apple con 128 GB di memoria, display Super Retina XDR da 6,7\", ottime prestazioni e autonomia, colore Azzurro. Un mix di potenza e stile."
  },
  {
    id: "prod10",
    link: "https://amzn.to/4mBncTC",
    img: "https://m.media-amazon.com/images/I/51v1hYXGsdL._AC_SL1500_.jpg",
    nome: "Google Pixel 9 Pro XL",
    prezzo: "879,00€",
    descrizione: "Smartphone Android sbloccato con Gemini, sistema a tripla fotocamera posteriore, batteria con autonomia fino a 24 ore e display Super Actua da 6,8\". Colore: Grigio Verde. Memoria: 128GB."
  },
  {
    id: "prod11",
    link: "https://amzn.to/4mBncTC",
    img: "https://m.media-amazon.com/images/I/51v1hYXGsdL._AC_SL1500_.jpg",
    nome: "Google Pixel 9 Pro XL",
    prezzo: "879,00€",
    descrizione: "Smartphone Android sbloccato con Gemini, sistema a tripla fotocamera posteriore, batteria con autonomia fino a 24 ore e display Super Actua da 6,8\". Colore: Grigio Verde. Memoria: 128GB."
  },
  {
    id: "prod12",
    link: "https://amzn.to/4jlRfvO",
    img: "https://m.media-amazon.com/images/I/71yzJoE7WlL._AC_SL1500_.jpg",
    nome: "Apple iPhone 14 Pro Max – 128 GB (Ricondizionato)",
    prezzo: "689,00€",
    descrizione: "iPhone 14 Pro Max ricondizionato in ottime condizioni, con 128 GB di memoria e finitura Deep Purple. La qualità Apple con un ottimo risparmio."
  },
  {
    id: "prod13",
    link: "https://amzn.eu/d/j40eOtX",
    img: "https://m.media-amazon.com/images/I/619HAuZ95QL._AC_SL1500_.jpg",
    nome: "iPhone 16 (128GB) - Nero",
    prezzo: "759€",
    descrizione: "Altissima qualità Apple"
  },
  {
    id: "prod14",
    link: "https://amzn.to/3SnXwfz",
    img: "https://m.media-amazon.com/images/I/41sNR0PJCaL._AC_SX569_.jpg",
    nome: "SSC NAPOLI Maglietta Campioni",
    prezzo: "30€",
    descrizione: "Maglia ufficiale celebrativa"
  },
  {
    id: "prod15",
    link: "https://amzn.to/4kbOb6E",
    img: "https://m.media-amazon.com/images/I/71BHou6YJKL._AC_SY879_.jpg",
    nome: "Calvin Klein T-Shirt Uomo",
    prezzo: "18€",
    descrizione: "Stile minimal, 100% cotone"
  },
  {
    id: "prod16",
    link: "https://amzn.to/43xa5u6",
    img: "https://m.media-amazon.com/images/I/51V1TTs1U2L._AC_SX569_.jpg",
    nome: "adidas Squadra25 Jersey Short Sleeve T-Shirt Uomo",
    prezzo: "14,99€ (prima 23,00€, -35%)",
    descrizione: ""
  },
  {
    id: "prod17",
    link: "https://www.amazon.it/dp/B0F1P4F8SR/ref=cm_sw_r_as_gl_apa_gl_i_HYDVV9DGWX2M1DGRM3X2?linkCode=ml1&tag=tony6401-21",
    img: "https://m.media-amazon.com/images/I/71GSwlTsPDL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Sunsilk Crema Onde Meravigliose Crema Styling Capelli Mossi, Effetto Anticrespo",
    prezzo: "5,99€ (prima 32,34€, -81%)",
    descrizione: "Styling perfetto per capelli mossi, effetto anticrespo a lunga durata."
  },
  {
    id: "prod18",
    link: "https://amzn.to/4kGcGJg",
    img: "https://m.media-amazon.com/images/I/6171T++Z2mL._AC_SL1095_.jpg",
    nome: "Caffè Borbone Cialda Compostabile, Miscela Oro - 100 Cialde",
    prezzo: "15,19€ (prima 16,00€, -5%)",
    descrizione: "Prezzo consigliato: 22,34€ -32% di sconto"
  },
  {
    id: "prod19",
    link: "https://amzn.to/3Fbh43W",
    img: "https://m.media-amazon.com/images/I/8120xtA5GaL._AC_SL1500_.jpg",
    nome: "King C. Gillette Kit REGOLABARBA Uomo",
    prezzo: "27,37€",
    descrizione: "Kit professionale: Testina, 3 Pettini Regolatori, Spazzolina, Caricatore. Rasoio elettrico, idea regalo."
  },
  {
    id: "prod20",
    link: "https://amzn.to/3Ssmcnb",
    img: "https://m.media-amazon.com/images/I/31SLM5sJK4L.__AC_SY300_SX300_QL70_ML2_.jpg",
    nome: "Samsung Galaxy S24 Ultra – 12GB / 256GB",
    prezzo: "864,90€",
    descrizione: "Smartphone top di gamma Samsung, 12GB RAM, 256GB memoria, colore Black. Prestazioni e design premium."
  },
  {
    id: "prod21",
    link: "https://amzn.to/3SUojjE",
    img: "https://m.media-amazon.com/images/I/812azAWbm2L.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Oral-B Testine Di Ricambio Original",
    prezzo: "24,99€",
    descrizione: "10 testine Pro Cross Action per spazzolino elettrico Oral-B, ricambio originale."
  },
  {
    id: "prod22",
    link: "https://amzn.to/4jhgwHr",
    img: "https://m.media-amazon.com/images/I/51B45gaTgjL._AC_SL1000_.jpg",
    nome: "Amazon Fire TV Stick HD",
    prezzo: "28,99€",
    descrizione: "Amazon Fire TV Stick HD (Ultimo modello), TV gratuita e in diretta, telecomando vocale Alexa, controlli per Casa Intelligente, streaming HD."
  },
  {
    id: "prod23",
    link: "https://amzn.to/4dCu1QL",
    img: "https://m.media-amazon.com/images/I/618HDC8rPXL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Bronzi® Portafoglio Uomo Slim Piccolo",
    prezzo: "22,99€",
    descrizione: "Portacarte uomo e donna, portatessere con protezione RFID, porta carte di credito e portamonete. Mini, slim, con box regalo. Brand italiano di qualità."
  },
  {
    id: "prod24",
    link: "https://amzn.to/4kEfeHI",
    img: "https://m.media-amazon.com/images/I/61oxHY8kFbL._AC_SX569_.jpg",
    nome: "Vittorio Y Camicia Donna in Cotone e Lino",
    prezzo: "19,99€",
    descrizione: "Camicia casual tinta unita, comoda e traspirante, perfetta per la stagione calda. Resi gratuiti su Amazon."
  },
  {
    id: "prod25",
    link: "https://amzn.to/4dF2SwD",
    img: "https://m.media-amazon.com/images/I/618FhFPg8+L._AC_SX575_.jpg",
    nome: "Nike Air Force 1 '07 Lv8 4",
    prezzo: "116,00€",
    descrizione: "Scarpe da basket uomo, modello iconico Nike Air Force 1 con design classico e comfort duraturo."
  },
  {
    id: "prod26",
    link: "https://amzn.to/3Z7S8Rr",
    img: "https://m.media-amazon.com/images/I/41vC0GMKWJL._AC_SY695_.jpg",
    nome: "adidas Breaknet Lifestyle Court Lace Shoes",
    prezzo: "28,80€",
    descrizione: "Scarpe da tennis unisex per bambini e ragazzi. Prezzo più basso ultimi 30 giorni: 32,73€. Offerta a tempo con risparmio del 12% rispetto al prezzo recente."
  },
  {
    id: "prod27",
    link: "https://amzn.to/4dCt9LX",
    img: "https://m.media-amazon.com/images/I/71XHPuLiHVL._AC_SY606_.jpg",
    nome: "Nike Everyday Cush Crew Calze Uomo",
    prezzo: "14,99€",
    descrizione: "Calze da uomo Nike, modello Everyday Cush Crew, ideali per comfort quotidiano e performance sportive."
  },
  {
    id: "prod28",
    link: "https://amzn.to/4kFlpLJ",
    img: "https://m.media-amazon.com/images/I/71ZfLtLMYyL._AC_SX679_.jpg",
    nome: "Smart Sir Calzini Sportivi Uomo e Donna (4 paia)",
    prezzo: "9,49€",
    descrizione: "Calzini lunghi in cotone di alta qualità, comodi e traspiranti. Prezzo più basso ultimi 30 giorni: 9,99€. Offerta a tempo."
  },
  {
    id: "prod29",
    link: "https://amzn.to/3Z7eYZz",
    img: "https://m.media-amazon.com/images/I/51kcic+JN-L._AC_SL1095_.jpg.jpg",
    nome: "Caffè Borbone Respresso, Miscela Blu - 100 Capsule",
    prezzo: "19,49€",
    descrizione: "Caffè Borbone Respresso, Miscela Blu - 100 Capsule - Compatibili con le Macchine ad uso domestico Nespresso"
  },
  {
    id: "prod30",
    link: "https://amzn.to/43PvEHy",
    img: "https://m.media-amazon.com/images/I/81irfL63EQL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Samsung Galaxy S22+ 5G – 128GB (Ricondizionato)",
    prezzo: "284,99€",
    descrizione: "Smartphone ricondizionato con SIM singola + e-SIM, colore Phantom Black, memoria 128GB. Risparmia 155,00€ rispetto al prezzo nuovo."
  },
  {
    id: "prod31",
    link: "https://amzn.to/3HsKGdy",
    img: "https://m.media-amazon.com/images/I/61CY-+ZEN6L._AC_SY300_SX300_.jpg",
    nome: "Samsung Galaxy S21 Ultra 5G – 128GB (Ricondizionato)",
    prezzo: "294,99€",
    descrizione: "Smartphone ricondizionato, RAM 12GB, Dual SIM (e-SIM), colore Nero. Ottima occasione con risparmio di 155,00€ rispetto al prezzo nuovo."
  },
  {
    id: "prod32",
    link: "https://amzn.to/3FcZUD1",
    img: "https://m.media-amazon.com/images/I/61pc4vR8BoL._AC_SL1500_.jpg",
    nome: "Samsung Galaxy A16",
    prezzo: "120,98€",
    descrizione: "Samsung Galaxy A16 Smartphone Android 14, Display Super AMOLED 6.7\" FHD+, 4GB RAM, 128GB, Batteria 5.000 mAh, Resistenza IP54, memoria espandibile fino a 1.5TB, Black"
  },
  {
    id: "prod33",
    link: "https://amzn.to/43ECrTf",
    img: "https://m.media-amazon.com/images/I/616+oTRo6-L._AC_SL1500_.jpg",
    nome: "Samsung Galaxy A56 5G",
    prezzo: "342,68€",
    descrizione: "Samsung Galaxy A56 5G, smartphone Android, 256 GB di memoria, 8 GB di RAM, antracite, aggiornamento del sistema operativo 6X, grande schermo, lunga durata della batteria"
  },
  {
    id: "prod34",
    link: "https://amzn.to/43gLxGT",
    img: "https://m.media-amazon.com/images/I/61waTtq8hCL._AC_SL1500_.jpg",
    nome: "GALAXY A26 5G – 8GB + 256GB",
    prezzo: "234,69€",
    descrizione: "Smartphone GALAXY A26 5G con 8GB di RAM e 256GB di memoria interna. Colore: Black."
  },
  {
    id: "prod35",
    link: "https://amzn.to/43RhVzW",
    img: "https://m.media-amazon.com/images/I/713AzRHXYeL._AC_SL1500_.jpg",
    nome: "UpCircle Cotton fioc di bambù – 200 pezzi –",
    prezzo: "5,49€",
    descrizione: "UpCircle Cotton fioc di bambù – 200 pezzi – biodegradabili, sostenibili, senza plastica, completamente riciclabili – un punto fermo per qualsiasi bagno"
  },
  {
    id: "prod36",
    link: "https://amzn.to/3FoIjIi",
    img: "https://m.media-amazon.com/images/I/61MKKroaphL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Supradyn Energy Multivitaminico – 70 Caramelle",
    prezzo: "11,19€",
    descrizione: "Integratore multivitaminico con vitamine A, B, C, D, E e Coenzima Q10. 70 caramelle gommose al gusto ciliegia, lampone e arancia."
  },
  {
    id: "prod37",
    link: "https://amzn.to/4jnbTvu",
    img: "https://m.media-amazon.com/images/I/51HcFzY9EmL._AC_SL1080_.jpg",
    nome: "ZPAPER - 6 Rotoli Asciugamani",
    prezzo: "29,95€",
    descrizione: "Pura cellulosa, 2 veli, confezionati. Rotoloni asciugatutto multiuso per pulire i disastri."
  },
  {
    id: "prod38",
    link: "https://amzn.to/4jrHVq9",
    img: "https://m.media-amazon.com/images/I/91krk-VZlwL._AC_SL1500_.jpg",
    nome: "Amazon Basics Cerniera Sacchetti di stoccaggio sottovuoto",
    prezzo: "27,19€",
    descrizione: "20 unità con pompa a mano, per risparmiare spazio con efficienza e semplicità."
  },
  {
    id: "prod39",
    link: "https://amzn.to/43PsHqs",
    img: "https://m.media-amazon.com/images/I/7107Ze-04CL._AC_SL1500_.jpg",
    nome: "Amazon Basics - 8 Batterie Ricaricabili AA NiMH",
    prezzo: "13,52€",
    descrizione: "2000 mAh, ricaricabili fino a 1000 volte, pre-caricate e pronte all'uso."
  },
  {
    id: "prod40",
    link: "https://amzn.to/44Xo3rC",
    img: "https://m.media-amazon.com/images/I/812hFM3JmTL._AC_SL1500_.jpg",
    nome: "Fabuloso Ammorbidente Concentrato - 4x1,25L",
    prezzo: "18,72€",
    descrizione: "Profumo Fresco Mattino, 224 lavaggi. Fragranza attivata dal movimento, facilita la stiratura e lascia i capi morbidi e profumati."
  },
  {
    id: "prod41",
    link: "https://amzn.to/4mChp0i",
    img: "https://m.media-amazon.com/images/I/61QKPdoU5TL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "ZPAPER - 60 Rotoli di Carta Igienica",
    prezzo: "32,36€",
    descrizione: "60 rotoli, 250 fogli per rotolo, 2 veli, morbida e resistente. Ideale per casa o ufficio."
  },
  {
    id: "prod42",
    link: "https://amzn.to/3Hfvl04",
    img: "https://m.media-amazon.com/images/I/617i66nvMxL._AC_SY741_.jpg",
    nome: "Vitamina B12 Vegan 365 Compresse PiùLife",
    prezzo: "14,30€",
    descrizione: "Vitamina B12 Cianocobalamina, per sistema immunitario e riduzione stanchezza fisica e mentale. 1000 mcg."
  },
  {
    id: "prod43",
    link: "https://amzn.to/4dM4hSk",
    img: "https://m.media-amazon.com/images/I/71uuRXQz1JL._AC_SL1500_.jpg",
    nome: "Magnesio Citrato Vegano Tamponato (240 Capsule)",
    prezzo: "17,09€",
    descrizione: "Con 444mg polvere elementare, riduce stanchezza e affaticamento, senza additivi né glutine."
  },
  {
    id: "prod44",
    link: "https://amzn.to/4jq1SOj",
    img: "https://m.media-amazon.com/images/I/71GXfnVPsPL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Zzzquil Natura Integratore Per Il Sonno",
    prezzo: "36,99€",
    descrizione: "Melatonina con estratti di lavanda, valeriana e camomilla. Maxi formato 2x72 pastiglie gommose per favorire il sonno."
  },
  {
    id: "prod45",
    link: "https://amzn.to/3Z3U39Q",
    img: "https://m.media-amazon.com/images/I/71NY7I+OLQL._AC_SY300_SX300_.jpg",
    nome: "Novanight Tripla Azione Melatonina per Dormire",
    prezzo: "23,21€",
    descrizione: "Integratore per disturbi del sonno, senza glutine. Contiene melatonina, escolzia, passiflora e melissa. Non induce dipendenza."
  },
  {
    id: "prod46",
    link: "https://amzn.to/43PEXay",
    img: "https://m.media-amazon.com/images/I/61NUQEFRTFL._AC_SX522_.jpg",
    nome: "SWISSE Ultivit - Multivitaminico Ragazza (60 Compresse)",
    prezzo: "13,46€",
    descrizione: "Multivitaminico con zinco e vitamine per riduzione stanchezza e supporto sistema immunitario. Integratore con ferro, made in Italy."
  },
  {
    id: "prod47",
    link: "https://amzn.to/4mAMTnv",
    img: "https://m.media-amazon.com/images/I/51AyIO7mVXL._AC_SX569_.jpg",
    nome: "N-K PULABO Anello Intelligente Temperatura In Acciaio Inox",
    prezzo: "1,82€",
    descrizione: "Anello per coppie e amanti, cambia colore in base alla temperatura e all’umore. Unisex, in acciaio inox di alta qualità e design alla moda."
  },
  {
    id: "prod48",
    link: "https://amzn.to/4jlkrDe",
    img: "https://m.media-amazon.com/images/I/81Ev1JwtPhL._AC_SX569_.jpg",
    nome: "Amazon Essentials T-Shirt Basic Uomo - Pacco da 6",
    prezzo: "25,99€",
    descrizione: "Magliette girocollo in cotone, versatili e morbide, ideali per ogni occasione. Qualità Amazon Essentials in un conveniente pacco da 6."
  },
  {
    id: "prod49",
    link: "https://amzn.to/3SUAqNE",
    img: "https://m.media-amazon.com/images/I/61KSB-CGSyL._AC_SX569_.jpg",
    nome: "ALPIDEX T-Shirt Uomo - Confezione da 5",
    prezzo: "39,99€",
    descrizione: "Magliette da uomo con girocollo disponibili in varie taglie dalla S alla 5XL. Perfette per tutti i giorni, comode e resistenti."
  },
  {
    id: "prod50",
    link: "https://amzn.to/3Z60eKn",
    img: "https://m.media-amazon.com/images/I/81Auh7uuz1L._AC_SX466_.jpg",
    nome: "Amazon Essentials Felpa con Cappuccio Donna",
    prezzo: "19,60€",
    descrizione: "Felpa da donna in pile, con cappuccio e cerniera. Calda, comoda e ideale per l’uso quotidiano. Disponibile in vari colori e taglie."
  },
  {
    id: "prod51",
    link: "https://amzn.to/43qkEio",
    img: "https://m.media-amazon.com/images/I/61V8VUE1dFL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Amazfit Bip 5 Smartwatch 46 mm",
    prezzo: "57,99€",
    descrizione: "Smartwatch con schermo grande, chiamate Bluetooth, Alexa integrata, GPS, durata batteria 10 giorni, fitness tracker con battito cardiaco e monitoraggio ossigeno nel sangue."
  },
  {
    id: "prod52",
    link: "https://amzn.to/4jlczlj",
    img: "https://m.media-amazon.com/images/I/51Kmnt241oL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "Imou 3MP Telecamera Wi-Fi Interno",
    prezzo: "22,99€",
    descrizione: "Videocamera di sorveglianza 2K con tracciamento del movimento, rilevamento umano, audio bidirezionale e connessione 2,4GHz. Perfetta per la sicurezza domestica."
  },
  {
    id: "prod53",
    link: "https://amzn.to/43GhYgW",
    img: "https://m.media-amazon.com/images/I/81UE75N+r1L._AC_SL1500_.jpg",
    nome: "SEHMUA 4G LTE Telecamera Esterno senza Fili, Telecamera con Sim, 2K 360 PTZ, con Pannello Solare e Batterie",
    prezzo: "51,43€",
    descrizione: "Marca: SEHMUA. 4,3 su 5 stelle (134 recensioni). Amazon Choice. 200+ acquistati nel mese scorso. Offerta a tempo! Prezzo più basso ultimi 30 giorni: 54,14€"
  },
  {
    id: "prod54",
    link: "https://amzn.to/4kg3QC7",
    img: "https://m.media-amazon.com/images/I/71dy+yYz4iL._AC_SX522_.jpg",
    nome: "Amazon Essentials Maglietta Intima con Scollo A V",
    prezzo: "25,99€",
    descrizione: "Pacco da 6 magliette intime da uomo, traspiranti e in cotone, perfette per il comfort quotidiano."
  },
  {
    id: "prod55",
    link: "https://amzn.to/4mB7UhK",
    img: "https://m.media-amazon.com/images/I/71b8mpCMTOL.__AC_SX300_SY300_QL70_ML2_.jpg",
    nome: "by Amazon Quinoa biologica, 500g",
    prezzo: "5,49€",
    descrizione: ""
  },
  {
  "id": "prod56",
  "link": "https://amzn.to/3HusXTd",
  "img": "https://m.media-amazon.com/images/I/71Cm4at5uAL._AC_SL1500_.jpg",
  "nome": "NEW'C 3 Pezzi, Vetro Temperato per iPhone 16, iPhone 15 (6,1 Pollici)",
  "prezzo": "7,89€",
  "descrizione": "Pellicola protettiva anti graffio - ultra resistente - trasparente HD - strumento di installazione facile incluso. Prezzo per unità: 2,63€."
  },
  {
  "id": "prod57",
  "link": "https://amzn.to/3FozrT6",
  "img": "https://m.media-amazon.com/images/I/71+5mYCqy7S._AC_SX342_SY445_.jpg",
  "nome": "Apple AirTag",
  "prezzo": "28,99€",
  "descrizione": "Dispositivo di localizzazione Bluetooth per ritrovare oggetti come chiavi, zaini e altro tramite l'app Dov'è su iPhone."
  },
  {
  "id": "prod58",
  "link": "https://amzn.to/3T8pQCT",
  "img": "https://m.media-amazon.com/images/I/71fRnkkqVdL.__AC_SX300_SY300_QL70_ML2_.jpg",
  "nome": "HP 305 Nero e Tricromia, 6ZD17AE - Confezione da 2 Cartucce Originali",
  "prezzo": "24,99€",
  "descrizione": "Compatibili con stampanti HP DeskJet serie 2300, 2700, 2800, 4200, 4100, HP Envy 6010, 6020, 6030 e 6040. Prezzo per cartuccia: 12,50€."
  },
  {
  "id": "prod59",
  "link": "https://amzn.to/4dTbdNq",
  "img": "https://m.media-amazon.com/images/I/61DvMw16ITL.__AC_SY445_SX342_QL70_ML2_.jpg",
  "nome": "Apple AirPods 4",
  "prezzo": "128,99€",
  "descrizione": "Auricolari wireless Bluetooth con audio spaziale personalizzato, resistenza al sudore e all’acqua, custodia di ricarica USB-C, chip H2, fino a 24 ore di autonomia."
  },
  {
  "id": "prod60",
  "link": "https://amzn.to/3SEY4xJ",
  "img": "https://m.media-amazon.com/images/I/61fSyWVkrYL.__AC_SY300_SX300_QL70_ML2_.jpg",
  "nome": "Tapo C200 Telecamera Wi-Fi Interno FHD, Videocamera sorveglianza, Visione Notturna, 360° Visuale, Audio Bidirezionale, Rilevamento di movimento e notifiche, Allarme acustico e luminoso integrato",
  "prezzo": "21,99€ (-27%)",
  "descrizione": "<span class='badge-animated'>Scelta Amazon</span> - 5000+ acquistati nel mese scorso, valutazione 4,6 su 5 (136.881 recensioni)"
  },
  {
  "id": "prod61",
  "link": "https://amzn.to/4kCXBZd",
  "img": "https://m.media-amazon.com/images/I/61c9X3+N4AL._AC_SX300_SY300_.jpg",
  "nome": "Caricatore USB C Rapido 40W 4Porto Presa USB Caricatore Multipla PD & QC3.0 Carica Cellulare, Spina Alimentatore Caricabatterie per Samsung S22 S23 S24 iPhone 15 16 14, Spinotto Muro Adattatore",
  "prezzo": "10,99€",
  "descrizione": "<span class='badge-animated'>Scelta Amazon</span> - 5000+ acquistati nel mese scorso, valutazione 4,6 su 5 (3.438 recensioni). Disponibile anche con coupon 20% e varianti Medium, Medium+Cavo USB C a USB C (14,99€), Large+2Pack (20,99€, -13%)"
  }


];
    // --- UTENTE ---
    function getLikes() {
      return JSON.parse(localStorage.getItem('cronoshop_likes') || '{}');
    }
    function setLikes(likes) {
      localStorage.setItem('cronoshop_likes', JSON.stringify(likes));
    }
    function getCart() {
      return JSON.parse(localStorage.getItem('cronoshop_cart') || '[]');
    }
    function setCart(cart) {
      localStorage.setItem('cronoshop_cart', JSON.stringify(cart));
    }
    function count() { // Aggiunta la definizione della funzione count()
      const cart = getCart();
      const cartCountElement = document.getElementById('cart-count');
      if (cartCountElement) {
        cartCountElement.textContent = cart.length;
      }
    }


    // --- PUNTI E CLASSIFICA ---
    function getPoints() {
      return JSON.parse(localStorage.getItem('cronoshop_points') || '{}');
    }
    function setPoints(points) {
      localStorage.setItem('cronoshop_points', JSON.stringify(points));
    }

    // --- RENDER PRODOTTI ---
    
    function renderProducts(filtro = '') {
      const likes = getLikes();
      const cart = getCart();
      const grid = document.getElementById('product-grid');
      grid.innerHTML = '';
      const filtroLower = filtro.toLowerCase();

      prodotti
        .filter(prod => prod.nome.toLowerCase().includes(filtroLower) || prod.descrizione.toLowerCase().includes(filtroLower))
        .forEach(prod => {
          const liked = likes[prod.id] === true;
          const inCart = cart.includes(prod.id);
          const priceHtml = prod.prezzo.toString().includes('<span') ? prod.prezzo : `<span class="price">${prod.prezzo}</span>`;
          const card = document.createElement('div');
          card.className = 'product-card';
          card.innerHTML = `
            <img src="${prod.img}" alt="${prod.nome}" class="product-img">
            <h3>${prod.nome}</h3>
            <p class="price">${priceHtml}</p>
            <p>${prod.descrizione}</p>
            <button class="like-btn${liked ? ' liked' : ''}" data-id="${prod.id}">${liked ? '❤️' : '🤍'} Mi piace</button>
            <button class="cart-btn${inCart ? ' added' : ''}" data-id="${prod.id}">${inCart ? 'Aggiunto!' : 'Aggiungi al carrello'}</button>
            <a href="${prod.link}" class="amazon-link" data-id="${prod.id}" target="_blank" rel="noopener noreferrer">
              <button class="amazon-link-btn">Compra su Amazon</button>
            </a>
          `;
          grid.appendChild(card);
        });
    }

    // --- EVENTI ---
    document.addEventListener('click', function(e) {
      // Mi piace
      if (e.target.classList.contains('like-btn')) {
        const id = e.target.getAttribute('data-id');
        const likes = getLikes();
        likes[id] = !likes[id];
        setLikes(likes);
        renderProducts(document.getElementById('search-input').value);
        count();
      }
      // Carrello
      if (e.target.classList.contains('cart-btn')) {
        const id = e.target.getAttribute('data-id');
        let cart = getCart();
        if (!cart.includes(id)) {
          cart.push(id);
        } else {
          cart = cart.filter(pid => pid !== id);
        }
        setCart(cart);
        renderProducts(document.getElementById('search-input').value);
        count();
      }
      // Tracciamento click Amazon
      if (e.target.closest('.amazon-link')) {
        const id = e.target.closest('.amazon-link').getAttribute('data-id');
        addPoint(getUsername());
        updateRanking();
      }
    });

    // --- PUNTI E CLASSIFICA ---
    function addPoint(username) {
      const points = getPoints();
      if (!points[username]) points[username] = 0;
      points[username]++;
      setPoints(points);
      updateUserScore();
    }
    function updateUserScore() {
      const points = getPoints();
      const username = getUsername();
      const score = points[username] || 0;
      document.getElementById('user-score').textContent = `Il tuo punteggio: ${score} punto${score === 1 ? '' : 'i'}`;
    }
    function updateRanking() {
      const points = getPoints();
      const ranking = Object.entries(points)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      const list = document.getElementById('ranking-list');
      list.innerHTML = '';
      ranking.forEach(([user, score], i) => {
        list.innerHTML += `<li>${i === 0 ? '🏆 ' : ''}${user} <span style="color:#0071e3;font-weight:600;">${score}</span></li>`;
      });
    }

    // --- INIZIALIZZA ---
    // Event listeners per l'inizializzazione universale (copia da index.html)
    document.addEventListener('DOMContentLoaded', function() {
        loadThemePreference(); // Carica il tema all'avvio della pagina
        updateAccountBannerAndWidget(); // Inizializza banner e widget

        const openLoginBtn = document.getElementById('open-login');
        const openRegisterBtn = document.getElementById('open-register');
        const modalBg = document.getElementById('modal-bg');
        const userProfileWidget = document.getElementById('user-profile-widget');

        if (openLoginBtn) openLoginBtn.onclick = showLogin;
        if (openRegisterBtn) openRegisterBtn.onclick = showRegister;
        if (modalBg) {
            modalBg.onclick = function(e) {
                if (e.target === this) closeModal();
            };
        }
        
        // Gestore per il click sul widget account
        if (userProfileWidget) {
            userProfileWidget.addEventListener('click', function(e) {
                // Impedisci la navigazione se clicchi sul pulsante di logout all'interno del widget
                if (e.target.classList.contains('logout-button')) {
                    return;
                }
                window.location.href = "account.html";
            });
        }

      // Inizializzazione prodotti e ranking (originale di products.html)
      renderProducts();
      document.getElementById('search-input').addEventListener('input', function(e) {
        renderProducts(e.target.value);
      });
      count();
      updateUserScore();
      updateRanking();
    });
  </script>
</body>
</html>
